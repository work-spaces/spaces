# spaces

`spaces` is a workspace builder and task-runner. It is powered by `starlark` and `rust`.

You simply define a starlark script that defines what code you need and what command to run and `spaces` does the rest.

`config/spaces_build.star`:

```star
checkout.add_repo(
    rule = { "name": "spaces" },
    repo = {
        "url": "https://github.com/work-spaces/spaces",
        "rev": "main",
        "checkout": "Revision",
    },
)

run.add_exec(
    rule = { "name": "build" },
    exec = {
        "command": "cargo",
        "working_directory": "spaces",
        "args": [
            "build",
            "--profile=release",
        ],
    },
)
```

```sh
# checkout does an efficient clone (bare repo plus worktree)
spaces checkout config/spaces_build --space=spaces-test
cd spaces-test
spaces run build
```

## Using spaces

`spaces` executes `starlark` scripts in two phases:

- Checkout: (effiently) collects everything from source code to tools into a local workspace folder
- Run: execute user-defined rules to build, test, run or deploy your project

### Checkout phase

`spaces` creates folder populated with everything you need for your project.

- `sysroot`: hardlinks to everything you normally put in `/usr/local`
- `tools`: repos used for pulling in sysroot tools
- `libs`: repos where you want to see the source but not modify the source
- `env`: source this file to access tools in the sysroot (and limit access to other paths)
- `spaces_logs`: folder for spaces to log the steps it takes
- `spaces.star`: starlark file generated by `spaces` containing run rules and lock info
- `README.md`: this is a user-defined file that `spaces` generates so that users know what to do
-  sources: various source code repositories that you want to modify

### Run phase

The run rules execute tasks in order and as needed. Run rules have:

- `name`: the way to refer to this task when adding dependencies to other tasks
- an action: typically launch a process but there are a few others
- `deps`: explicit dependencies that must run before this task
- `inputs`/`outputs`: when inputs of one task match outputs of another task a dependency is created implicitly

Specified inputs are hashed. If the inputs haven't changed, the rule is skipped. If no `inputs` are specified, the rule always runs.




